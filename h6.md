## H6: Vuohi

## Host-kone: AMD Ryzen 5800X3D, NVIDIA RTX 3080, 32GB DDR4, Windows 11 23H2

### x) Lue/katso ja tiivistä. (Tässä x-alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen tai kuunteleminen ja tiivistelmä riittää. Tiivistämiseen riittää muutama ranskalainen viiva kustakin artikkelista. Kannattaa lisätä myös jokin oma ajatus, idea, huomio tai kysymys.)

- Webgoatin asennukseen tarvitaan java sekä palomuuri, helppo asentaa paketinhallinnasta.
- Se ladataan webgoatin github-sivuilta, kävin katsomassa niin kotisivulta ladattuna he tarjoaa myös dockerin kanssa käytettävää versiota. 
- Kannattaa vaihtaa sen portti käyttämättömään porttiin, jos siellä sattuisi olemaan jo jokin muu homma samalla portilla
- Sitten vaan ajetaan se .jar file javalla. 

### a) Asenna Webgoat 2023.4

Kokeillaas Kaliin tämän asentamista. Päivitän paketit `sudo apt update` ja `sudo apt upgrade`. Sitten asennetaan palomuuri ja java`sudo apt install ufw openjdk-17-jre`. Laitetaan palomuuri päälle `sudo ufw enable`. Varmuudeksi otetaan kone vielä pois netistä kokonaan Virtualboxin asetuksista. 

![image](https://github.com/user-attachments/assets/455fd17e-d30d-4925-8b36-cb93ab01eba5)

![image](https://github.com/user-attachments/assets/9ebb2302-7b83-4d41-b258-465571dc7b0a)

Java siellä olikin jo, palomuuri asentui.

Ladataan vielä webgoat 2023.4 `wget https://github.com/WebGoat/WebGoat/releases/download/v2023.4/`

![image](https://github.com/user-attachments/assets/d5a596ae-46c5-4eb3-81e0-74374bd349d6)

Sitä ei löytynyt, kokeillaampas Teron mirrorista. Löytyy artikkelista Try Web Hacking on New Webgoat 2023.4 https://terokarvinen.com/2023/webgoat-2023-4-ethical-web-hacking/

![image](https://github.com/user-attachments/assets/35032916-445a-4b70-9588-3899d5f0c21c)

Sitten kone netistä pois, reboot ja käynnistetään webgoat portille 8888 `java -Dfile.encoding=UTF-8 -Dwebgoat.port=8888 -Dwebwolf.port=9090 -jar webgoat-2023.4.jar`

Käynnistyi!

![image](https://github.com/user-attachments/assets/88111a82-470c-4bd6-b77c-c7216844af4c)

### b) Ratkaise webgoat Broken access control

Loin käyttäjän webgoatiin:

![image](https://github.com/user-attachments/assets/3b843a36-c81e-4fa5-9bd2-80f1ccfd8f6c)

Ja pääsin sisään. Sivupalkista A1 Broken access control:

![image](https://github.com/user-attachments/assets/14827fa6-e8eb-4265-a202-6a52ed2bb026)

Tässä tehtävässä pitää arvata hijack_cookie -nimisen evästeen arvo, ja päästä toisella käyttäjällä sisään. Selaimen consolesta storageen ja siellähän se on.

![image](https://github.com/user-attachments/assets/a551bcae-c9ae-4d1a-a981-2d5ecc3fffd6)

En tiedä mitä tässä lähtisi ekana kokeilemaan. Kokeilin vaihtaa tuon ennen väliviivaa olevan numeron yhden pienemmäksi. No luck. Tuo loppuosa näyttää epäilyttävän paljon unix-timestampilta. 

Se on vain tämän illan aika, varmaaan webgoatin käynnistymisen tai käyttäjän luonnin aika:

![image](https://github.com/user-attachments/assets/e594f4d4-0eb0-49f7-ac6a-13bab06ecae8)

Koitin noin 5-10 min miettiä, mutten keksinyt miten tuota voisi muuttaa. Jouduin lunttaamaan valmiista ratkaisusta: https://www.youtube.com/watch?v=R5YPRhM5GyE

Siellä mainittiin tuon fuzzaamisesta, koska keksin vikat numerot lisääntyy aina yhdellä tai kahdella, eli siellä voi olla jonkun muun keksi joka pitää vain löytää. Onneksi ZAPissa on tämä ominaisuus. Right click requestista ja Fuzz.

Fuzzataan tuon keksin id:tä joka on ensimmäinen osa ja toinen osa on login timestamp, jota myös fuzzataan.

![image](https://github.com/user-attachments/assets/fcbc075d-8d0b-439d-a516-505a7fd62aec)

Ensimmäiseen numerot 25-50, jälkimmäiseen 1-999. Exporttasin tulokset CSV-tiedostoon ja koitin hakea sieltä tuloksia, mutta ei ollut mätchiä. Kokeillaan fuzzata eri numeroilla. Sekään ei tuottanut tulosta. Kokeilen nyt muita tehtäviä, jäin jumiin.




#### c) Ratkaise webgoat identity ja auth failure

Tässä pitää päästä ohittamaan turvallisuuskysymykset:

![image](https://github.com/user-attachments/assets/f81658d1-00ef-4545-b139-1238ca1417bc)

Kokeilin ZAPin request editorin kautta muuttaa parametrejä arvoihin TRUE, NULL, poistaa niitä, yms. Mutta en saanut toimimaan. Tästäkin katsoin netistä neuvoa, ja pyyntö rikotaan sillä että lisätään 0 ja 1 pyynnön parametreihin, että SecQuestion0 onkin SecQuestion00 jne. 

![image](https://github.com/user-attachments/assets/459a2ebd-3518-4cde-be2a-6d3237b8ca55)

Victory! Hitsi kun ois tajunnut kokeilla muuttaa itse parametrin nimeä eikä vain arvoja ennen kuin luovuttaa...

##### Toinen auth failure on Insecure Login.

Kun tehtävässä painaa log in, lähtee seuraava paketti tällä user/password combolla:

![image](https://github.com/user-attachments/assets/dd29c021-d284-4b91-8676-12878b868212)

Kokeilin  tuossa paketissa olevaa käyttäjää, ja sehän toimi!

![image](https://github.com/user-attachments/assets/50c6a63e-e8e5-497b-8ab6-ae81f6e11a56)



#### d) Ratkaise webgoat SSRF

#### e) Ratkaise webgoat clientside

#### f) Editmenu: Lisää uusi oma komento micro:n palettero-lisäkkeellä käytettäväksi.

Tämän tein jo tunnilla, joten SCREENSHOTIT MACISTA

## Lähteet:

https://terokarvinen.com/tunkeutumistestaus/

https://docs.cycubix.com/application-security-series/web-application-security-essentials/solutions/a5-broken-access-control/a1-2021-or-hijack-a-session-or-cycubix-docs/a1-2021-or-hijack-a-session-2-or-cycubix-docs

https://www.youtube.com/watch?v=R5YPRhM5GyE

https://terokarvinen.com/2023/webgoat-2023-4-ethical-web-hacking/

https://docs.cycubix.com/application-security-series/web-application-security-essentials/solutions/a7-2021-or-identity-and-authentication-failure-or-cycubix-docs/a7-2021-or-authentication-bypasses-or-cycubix-docs/a7-2021-or-authentication-bypasses-2-or-cycubix-docs
